<!DOCTYPE html>
<!-- File: CustomMarkupDoc/KryptoMarkup.html -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KryptoMarkup Language Showcase</title>
    <style>
        @font-face {
            font-family: 'Gentium';
            src: url('Gentium-Regular.ttf') format('truetype');
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .demo-section {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .demo-section h2 {
            color: #667eea;
            margin-top: 0;
        }

        .markup-example {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Gentium';
            border: 1px solid #dee2e6;
        }

        .rendered-result {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 2px solid #28a745;
            position: relative;
        }

        .rendered-result::before {
            content: "Rendered Output:";
            position: absolute;
            top: -12px;
            left: 10px;
            background: #28a745;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        /* Custom markup styles */
        .bold-text { font-weight: bold; }
        .italic-text { font-style: italic; }
        .underline-text { text-decoration: underline; }
        .superscript-text { vertical-align: super; font-size: 0.8em; }
        .subscript-text { vertical-align: sub; font-size: 0.8em; }
        .link-text { 
            color: #007bff; 
            text-decoration: underline;
            cursor: pointer;
        }
        .redirect-link { 
            color: #007bff; 
            text-decoration: underline;
            cursor: pointer;
        }
        .broken-redirect-link {
            color: red;
            text-decoration: underline;
            cursor: pointer;
        }
        .template-text {
            background-color: #fff3cd; 
            padding: 8px 12px; 
            border-radius: 5px;
            border: 1px solid #ffeaa7;
            display: block;
            margin: 5px 0;
        }
        .category-text { 
            background-color: #d1ecf1; 
            padding: 2px 4px; 
            border-radius: 3px;
            border: 1px solid #bee5eb;
        }
        .barred-text { 
            text-decoration: line-through;
            opacity: 0.7;
        }
        .code-text { 
            font-family: 'Courier New', monospace; 
            background-color: #f8f9fa; 
            padding: 2px 6px; 
            border-radius: 4px;
            border: 1px solid #e9ecef;
            font-size: 0.9em;
        }
        .citation-text { 
            font-size: 0.9em;
            color: #555;
            font-style: italic;
            background-color: #f9f9f9;
            padding: 2px 4px;
            border-left: 3px solid #ccc;
            margin: 2px 0;
            display: inline-block;
        }
        .comment-text { 
            color: #6c757d; 
            font-style: italic;
            opacity: 0.8;
        }
        .block-quote {
            margin: 15px 0;
            padding: 10px 20px;
            border-left: 4px solid #ddd;
            background-color: #f9f9f9;
            font-style: italic;
            color: #666;
        }
        .signature {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
        }
        .user-link, .talk-link {
            color: #0645ad;
            text-decoration: none;
        }
        .user-link:hover, .talk-link:hover {
            text-decoration: underline;
        }
        .reply-button {
            background: #0645ad;
            color: white;
            border: none;
            padding: 2px 6px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            margin-left: 5px;
        }
        .reply-button:hover {
            background: #0b5394;
        }
        .math-table {
            font-family: 'Courier New', monospace;
            border-collapse: collapse;
            margin: 10px 0;
            text-align: right;
            display: inline-table;
        }
        .math-table td {
            padding: 2px 5px;
        }
        .math-table .result-row {
            border-top: 1px solid #000;
        }

        .interactive-demo {
            margin-top: 40px;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 10px;
        }

        .interactive-demo h2 {
            color: #1976d2;
        }

        #markup-input {
            width: 100%;
            height: 100px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-family: 'Gentium';
            resize: vertical;
        }

        #live-output {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border: 2px solid #1976d2;
            border-radius: 5px;
            min-height: 50px;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.3s;
        }

        button:hover {
            background: #5a6fd8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎨 KryptoMarkup Language Showcase</h1>
        
        <div class="demo-section">
            <h2>Text Formatting</h2>
            
            <div class="markup-example">[bold]Bold text[bold]</div>
            <div class="rendered-result">
                <span class="bold-text">Bold text</span>
            </div>

            <div class="markup-example">[italic]Italic text[italic]</div>
            <div class="rendered-result">
                <span class="italic-text">Italic text</span>
            </div>

            <div class="markup-example">[underline]Underlined text[underline]</div>
            <div class="rendered-result">
                <span class="underline-text">Underlined text</span>
            </div>
        </div>

        <div class="demo-section">
            <h2>Script Formatting</h2>
            
            <div class="markup-example">[superscript]Superscript text[superscript] [subscript]Subscript text[subscript]</div>
            <div class="rendered-result">
                <span class="superscript-text">Superscript text</span> <span class="subscript-text">Subscript text</span>
            </div>
        </div>

        <div class="demo-section">
            <h2>Links and References</h2>
            
            <div class="markup-example">[link url="https://example.com" text="Text with link"]</div>
            <div class="rendered-result">
                <span class="link-text" onclick="window.open('https://example.com', '_blank')">Text with link</span>
            </div>

            <div class="markup-example">[R̤Link to redirect to]</div>
            <div class="rendered-result">
                Redirect: <span class="redirect-link" onclick="alert('Redirect link clicked!')">Link to redirect to</span>
            </div>
        </div>

        <div class="demo-section">
            <h2>Content Warnings</h2>
            
            <div class="markup-example">[delete|reason="copyright infringement"]</div>
            <div class="rendered-result">
                <table style="background: red; border-collapse: collapse; margin: auto; border: 1px solid #ddd;">
                    <tr>
                        <td style="font-size: 50px;">!</td>
                        <td><p style="font-size: 20px;">This article might meet Kryptopedia's<br>deletion policy because of copyright<br>infringement. If this article is not copyright<br>infringement, remove the deletion tag.</p></td>
                    </tr>
                </table>
            </div>

            <div class="markup-example">[delete|reason="duplicate to: Close-mid back unrounded vowel"]</div>
            <div class="rendered-result">
                <table style="background: red; border-collapse: collapse; margin: auto; border: 1px solid #ddd;">
                    <tr>
                        <td style="font-size: 50px;">!</td>
                        <td><p style="font-size: 20px;">This article might meet Kryptopedia's<br>deletion policy because it is<br>a duplicate to the following article:<br><a href="#" style="text-decoration: underline;">Close-mid back unrounded vowel</a><br>and additionally has the same title.</p></td>
                    </tr>
                </table>
            </div>

            <div class="markup-example">[non-encyclopedic content]</div>
            <div class="rendered-result">
                <table style="background: white; border-collapse: collapse; margin: auto; border: 1px solid #ddd;">
                    <tr>
                        <td style="color: orange; font-size: 50px;">!</td>
                        <td><p style="font-size: 20px;">This article is not a part of Kryptopedia's<br>encyclopedic content. It may contain stuff<br>like made up, test, or promotional<br>content, though it should not be deleted.</p></td>
                    </tr>
                </table>
            </div>

            <div class="markup-example">[short article]</div>
            <div class="rendered-result">
                <table style="background: white; border-collapse: collapse; margin: auto; border: 1px solid #ddd;">
                    <tr>
                        <td><p style="font-size: 20px;">This article is short.<br>You can help expand it.</p></td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="demo-section">
            <h2>Structure & Organization</h2>
            
            <div class="markup-example">[header="1"|Main Heading]</div>
            <div class="rendered-result">
                <h1>Main Heading</h1>
            </div>

            <div class="markup-example">[header="2"|Section Heading]</div>
            <div class="rendered-result">
                <h2>Section Heading</h2>
            </div>

            <div class="markup-example">[header="3"|Subsection Heading]</div>
            <div class="rendered-result">
                <h3>Subsection Heading</h3>
            </div>

            <div class="markup-example">. Example<br>. EXample<br>. EXAmple<br>. EXAMple<br>. EXAMPle<br>. EXAMPLe<br>. EXAMPLE</div>
            <div class="rendered-result">
                <ul>
                    <li>Example</li>
                    <li>EXample</li>
                    <li>EXAmple</li>
                    <li>EXAMple</li>
                    <li>EXAMPle</li>
                    <li>EXAMPLe</li>
                    <li>EXAMPLE</li>
                </ul>
            </div>

            <div class="markup-example">123 First<br>123 Second<br>123 Third</div>
            <div class="rendered-result">
                <ol>
                    <li>First</li>
                    <li>Second</li>
                    <li>Third</li>
                </ol>
            </div>

            <div class="markup-example">[table]<br>[table row]<br>[table header]First header[table header]<br>[table header]Second header[table header]<br>[table row]<br>----------<br>[table row]<br>[table cell]First cell[table cell]<br>[table cell]Second cell[table cell]<br>[table row]<br>[table]</div>
            <div class="rendered-result">
                <table style="border-collapse: collapse; border: 1px solid #ddd;">
                    <tr>
                        <th style="border: 1px solid #ddd; padding: 8px; background-color: #f2f2f2;">First header</th>
                        <th style="border: 1px solid #ddd; padding: 8px; background-color: #f2f2f2;">Second header</th>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 8px;">First cell</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">Second cell</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="demo-section">
            <h2>Templates & Special Elements</h2>
            
            <div class="markup-example">[T name="IPA infobox"|above=Voiced alveolar lateral approximant|ipa symbol=l|ipa symbol2=ɮ˕]</div>
            <div class="rendered-result">
                <table style="max-width: 300px; height: 170px; float: right;">
                    <tr>
                        <td style="background: #f2f2ce; font-weight: bold;">Voiced alveolar lateral approximant</td>
                    </tr>
                    <tr>
                        <td style="background: #ffffe6; font-size: 50px; text-align: center;" title="IPA symbol">l</td>
                    </tr>
                    <tr>
                        <td style="background: #ffffe6; font-size: 50px; text-align: center;" title="IPA symbol">ɮ˕</td>
                    </tr>
                </table>
                <div style="clear: both;"></div>
            </div>

            <div class="markup-example">C̤Phonetics, Linguistics, Consonants. This is regular text that follows.</div>
            <div class="rendered-result">
                Categories: <span class="category-text">Phonetics</span>, <span class="category-text">Linguistics</span>, <span class="category-text">Consonants</span>. This is regular text that follows.
            </div>

            <div class="markup-example">[bar]Barred text[bar]</div>
            <div class="rendered-result">
                <span class="barred-text">Barred text</span>
            </div>

            <div class="markup-example">[code]Code such as html or python[code]</div>
            <div class="rendered-result">
                <span class="code-text">Code such as html or python</span>
            </div>

            <div class="markup-example">[file|example-image.jpg|alt=Sample image]</div>
            <div class="rendered-result">
                <img src="files/example-image.jpg" alt="Sample image" style="max-width: 300px; border: 1px solid #ddd;">
            </div>

            <div class="markup-example">[file|Voiceless palatal tap.ogg|alt=Audio pronunciation]</div>
            <div class="rendered-result">
                <audio controls style="margin: 5px 0;">
                    <source src="files/Voiceless palatal tap.ogg" type="audio/ogg">
                    Your browser does not support the audio element.
                </audio>
                <br><em>Audio: Audio pronunciation</em>
            </div>

            <div class="markup-example">First line[break]Second line[break]Third line</div>
            <div class="rendered-result">
                First line<br>Second line<br>Third line
            </div>

            <div class="markup-example">[citation]Smith, J. (2023). Example Study. Journal of Examples, 15(3), 123-145.[citation]</div>
            <div class="rendered-result">
                <span class="citation-text">Smith, J. (2023). Example Study. Journal of Examples, 15(3), 123-145.</span>
            </div>

            <div class="markup-example">""This is a blockquote that stands out from the main text.""</div>
            <div class="rendered-result">
                <blockquote class="block-quote">This is a blockquote that stands out from the main text.</blockquote>
            </div>

            <div class="markup-example">Great point! ꬸ̰̃</div>
            <div class="rendered-result">
                Great point! <span class="signature">— <a href="#" class="user-link">Username</a> (<a href="#" class="talk-link">talk</a>) 15:42, August 22, 2025 (UTC) <button class="reply-button" onclick="alert('Reply to this comment')">Reply</button></span>
            </div>

            <div class="markup-example">[m̠᫈]6 + 6 = 12[m̠᫈]</div>
            <div class="rendered-result">
                <table class="math-table">
                    <tr>
                        <td></td>
                        <td>6</td>
                    </tr>
                    <tr>
                        <td>+</td>
                        <td>6</td>
                    </tr>
                    <tr>
                        <td colspan="2" class="result-row">12</td>
                    </tr>
                </table>
            </div>

            <div class="markup-example">[!This is a comment that won't appear]</div>
            <div class="rendered-result">
                <em style="color: #666;">Comments are hidden when rendered (like HTML comments)</em>
            </div>
        </div>

        <div class="demo-section">
            <h2>⚠️ Invalid Syntax</h2>
            <p><strong>Note:</strong> The following are invalid and should not be used:</p>
            
            <div style="background: #ffe6e6; border-left-color: #dc3545;">
                <strong>❌ Invalid:</strong> <span style="font-family: 'Gentium';">[!This is a comment [!nested comment] inside]</span>
            </div>
            <div style="background: #fff3cd; padding: 10px; border-radius: 5px;">
                Nesting comments inside comments is not allowed and this example will render as: inside]
            </div>

            <div style="background: #ffe6e6; border-left-color: #dc3545;">
                <strong>❌ Invalid:</strong> <span style="font-family: 'Gentium';">[code]function test() { [code]inner[code]
                }[code]</span>
            </div>
            <div style="background: #fff3cd; padding: 10px; border-radius: 5px;">
                Nesting code blocks inside code blocks is not allowed and this example will render as: <span class="code-text">function test() { </span>inner<span class="code-text"> }</span>
            </div>

            <div style="background: #ffe6e6; border-left-color: #dc3545;">
                <strong>❌ Invalid:</strong> <span style="font-family: 'Gentium';">[R̤NonexistentPage]</span> or <span style="font-family: 'Gentium';">[link url="nonexistent.html" text="Broken Link"]</span>
            </div>
            <div style="background: #fff3cd; padding: 10px; border-radius: 5px;">
               Renders as:<br>
               <span style="color: #dc3545;">Error: Page doesn't exist (L1)</span><br>Redirect: <span class="broken-redirect-link" onclick="alert('Redirect link clicked!')">NonexistentPage</span><br>
               or<br>
               <span style="color: #dc3545;">Error: Page doesn't exist (L1)</span><br><span style="color: red;" class="link-text" onclick="window.open('nonexistent.html', '_blank')">Broken Link</span>
            </div>
        </div>

        <div class="interactive-demo">
            <h2>🚀 Interactive Demo</h2>
            <p>Try your KryptoMarkup language live! Enter markup text below:</p>
            <textarea id="markup-input" placeholder="Enter your KryptoMarkup here, e.g., [bold]Hello[bold] [code]world[code]">[bold]Welcome[bold] to my [italic]KryptoMarkup[italic] language!

Table of alveolar laterals:
[table]
[table row]
[table header]Affricate[table header]
[table cell]tɬ dɮ[table cell]
[table row]
----------
[table row]
[table header]Fricative[table header]
[table cell]ɬ ɮ[table cell]
[table row]
----------
[table row]
[table header]Approximant[table header]
[table cell]l̥ l[table cell]
[table row]
----------
[table row]
[table header]Lateral flap[table header]
[table cell]ɺ̥ ɺ[table cell]
[table row]
[table]</textarea>
            <button onclick="parseMarkup()">Parse Markup</button>
            <div id="live-output"></div>
        </div>
    </div>

    <script>
        function parseMarkup() {
            const input = document.getElementById('markup-input').value;
            const output = document.getElementById('live-output');
            
            let parsed = input
                // Content warnings (parse FIRST)
                .replace(/\[delete\|reason="duplicate to: ([^"]+)"\]/g, function(match, articleTitle) {
                    return `<table style="background: red; border-collapse: collapse; margin: auto; border: 1px solid #ddd;">
                        <tr>
                            <td style="font-size: 50px;">!</td>
                            <td><p style="font-size: 20px;">This article might meet Kryptopedia's<br>deletion policy because it is<br>a duplicate to the following article:<br><a href="#" style="text-decoration: underline;">${articleTitle}</a><br>and additionally has the same title.</p></td>
                        </tr>
                    </table>`;
                })
                .replace(/\[delete\|reason="([^"]+)"\]/g, function(match, reason) {
                    return `<table style="background: red; border-collapse: collapse; margin: auto; border: 1px solid #ddd;">
                        <tr>
                            <td style="font-size: 50px;">!</td>
                            <td><p style="font-size: 20px;">This article might meet Kryptopedia's<br>deletion policy because of ${reason}.<br>If this article is not ${reason},<br>remove the deletion tag.</p></td>
                        </tr>
                    </table>`;
                })
                .replace(/\[non-encyclopedic content\]/g, `<table style="background: white; border-collapse: collapse; margin: auto; border: 1px solid #ddd;">
                    <tr>
                        <td style="color: orange; font-size: 50px;">!</td>
                        <td><p style="font-size: 20px;">This article is not a part of Kryptopedia's<br>encyclopedic content. It may contain stuff<br>like made up, test, or promotional<br>content, though it should not be deleted.</p></td>
                    </tr>
                </table>`)
                .replace(/\[short article\]/g, `<table style="background: white; border-collapse: collapse; margin: auto; border: 1px solid #ddd;">
                    <tr>
                        <td><p style="font-size: 20px;">This article is short.<br>You can help expand it.</p></td>
                    </tr>
                </table>`)
                // Templates (parse these before other formatting)
                .replace(/\[T name="IPA infobox"\|above=([^|]+)\|ipa symbol=([^|]+)(\|ipa symbol2=([^\]]+))?\]/g, function(match, phonName, symbol1, fullSymbol2, symbol2) {
                    let tableRows = `<table style="max-width: 300px; height: 170px; float: right;">
                        <tr>
                            <td style="background: #f2f2ce; font-weight: bold;">${phonName}</td>
                        </tr>
                        <tr>
                            <td style="background: #ffffe6; font-size: 50px; text-align: center;" title="IPA symbol">${symbol1}</td>
                        </tr>`;
                    
                    if (symbol2) {
                        tableRows += `<tr>
                            <td style="background: #ffffe6; font-size: 50px; text-align: center;" title="IPA symbol">${symbol2}</td>
                        </tr>`;
                    }
                    
                    tableRows += `</table><div style="clear: both;"></div>`;
                    return tableRows;
                })
                .replace(/\[T name="([^"]+)"(\|([^\]]*))?\]/g, function(match, templateName, fullParams, params) {
                    let content = `<strong>${templateName} Template</strong>`;
                    if (params) {
                        content += '<br>' + params.replace(/\|/g, ' | ');
                    }
                    return `<div class="template-text">${content}</div>`;
                })
                // Headers
                .replace(/\[header="([1-6])"\|([^\]]+)\]/g, '<h$1>$2</h$1>')
                // Files (images, audio, video, etc.)
                .replace(/\[file\|([^|]+)(\|alt=([^\]]*))?\]/g, function(match, filename, fullAlt, altText) {
                    let extension = filename.split('.').pop().toLowerCase();
                    let filePath = `files/${filename}`;
                    let alt = altText || filename;
                    
                    // Image files
                    if (['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg'].includes(extension)) {
                        return `<img src="${filePath}" alt="${alt}" style="max-width: 300px; border: 1px solid #ddd;">`;
                    }
                    // Audio files
                    else if (['mp3', 'wav', 'ogg', 'flac', 'm4a'].includes(extension)) {
                        return `<audio controls style="margin: 5px 0;">
                            <source src="${filePath}" type="audio/${extension === 'mp3' ? 'mpeg' : extension}">
                            Your browser does not support the audio element.
                        </audio><br><em>Audio: ${alt}</em>`;
                    }
                    // Video files
                    else if (['mp4', 'webm', 'ogv', 'avi', 'mov'].includes(extension)) {
                        return `<video controls style="max-width: 400px; margin: 5px 0;">
                            <source src="${filePath}" type="video/${extension}">
                            Your browser does not support the video element.
                        </video><br><em>Video: ${alt}</em>`;
                    }
                    // Other files (downloadable link)
                    else {
                        return `<a href="${filePath}" download style="color: #007bff; text-decoration: underline;">📎 ${alt}</a>`;
                    }
                })
                // Numbered Lists (convert lines starting with "123 " to numbered list items)
                .replace(/(^|\n)((?:123 .+(?:\n|$))+)/gm, function(match, prefix, listContent) {
                    let items = listContent.trim().split('\n').map(line => {
                        return line.replace(/^123 /, '').trim();
                    }).filter(item => item.length > 0);
                    
                    let listHtml = '<ol>';
                    items.forEach(item => {
                        listHtml += `<li>${item}</li>`;
                    });
                    listHtml += '</ol>';
                    
                    return prefix + listHtml;
                })
                // Lists (convert lines starting with ". " to list items)
                .replace(/(^|\n)((?:\. .+(?:\n|$))+)/gm, function(match, prefix, listContent) {
                    let items = listContent.trim().split('\n').map(line => {
                        return line.replace(/^\. /, '').trim();
                    }).filter(item => item.length > 0);
                    
                    let listHtml = '<ul>';
                    items.forEach(item => {
                        listHtml += `<li>${item}</li>`;
                    });
                    listHtml += '</ul>';
                    
                    return prefix + listHtml;
                })
                // Tables
                .replace(/\[table\]([\s\S]*?)\[table\]/g, function(match, tableContent) {
                    // Split by row separators
                    let rows = tableContent.split('----------').map(row => row.trim());
                    let html = '<table style="border-collapse: collapse; border: 1px solid #ddd;">';
                    
                    rows.forEach(rowContent => {
                        if (rowContent.includes('[table row]')) {
                            // Extract content between [table row] tags
                            let rowMatch = rowContent.match(/\[table row\]([\s\S]*?)\[table row\]/);
                            if (rowMatch) {
                                let cellsContent = rowMatch[1].trim();
                                html += '<tr>';
                                
                                // Handle headers
                                if (cellsContent.includes('[table header]')) {
                                    let headers = cellsContent.split(/\[table header\]/g).filter(h => h.trim());
                                    headers.forEach(header => {
                                        html += `<th style="border: 1px solid #ddd; padding: 8px; background-color: #f2f2f2;">${header.trim()}</th>`;
                                    });
                                }
                                
                                // Handle cells
                                if (cellsContent.includes('[table cell]')) {
                                    let cells = cellsContent.split(/\[table cell\]/g).filter(c => c.trim());
                                    cells.forEach(cell => {
                                        html += `<td style="border: 1px solid #ddd; padding: 8px;">${cell.trim()}</td>`;
                                    });
                                }
                                
                                html += '</tr>';
                            }
                        }
                    });
                    
                    html += '</table>';
                    return html;
                })
                // Math tables [m̠᫈]...[m̠᫈] - converts simple equations to table format
                .replace(/\[m̠᫈\](\d+)\s*([+\-×÷])\s*(\d+)\s*=\s*(\d+)\[m̠᫈\]/g, function(match, num1, operator, num2, result) {
                    return `<table class="math-table">
                        <tr>
                            <td></td>
                            <td>${num1}</td>
                        </tr>
                        <tr>
                            <td>${operator}</td>
                            <td>${num2}</td>
                        </tr>
                        <tr>
                            <td colspan="2" class="result-row">${result}</td>
                        </tr>
                    </table>`;
                })
                // Signatures (ꬸ̰̃)
                .replace(/ꬸ̰̃/g, function() {
                    let now = new Date();
                    let time = now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });
                    let date = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                    return `<span class="signature">— <a href="#" class="user-link">Username</a> (<a href="#" class="talk-link">talk</a>) ${time}, ${date} (UTC) <button class="reply-button" onclick="alert('Reply to this comment')">Reply</button></span>`;
                })
                // Blockquotes (double quotes)
                .replace(/""([^"]+)""/g, '<blockquote class="block-quote">$1</blockquote>')
                // Line breaks
                .replace(/\[break\]/g, '<br>')
                // Citations
                .replace(/\[citation\](.*?)\[citation\]/g, '<span class="citation-text">$1</span>')
                // Bold
                .replace(/\[bold\](.*?)\[bold\]/g, '<span class="bold-text">$1</span>')
                // Italic
                .replace(/\[italic\](.*?)\[italic\]/g, '<span class="italic-text">$1</span>')
                // Underline
                .replace(/\[underline\](.*?)\[underline\]/g, '<span class="underline-text">$1</span>')
                // Superscript
                .replace(/\[superscript\](.*?)\[superscript\]/g, '<span class="superscript-text">$1</span>')
                // Subscript
                .replace(/\[subscript\](.*?)\[subscript\]/g, '<span class="subscript-text">$1</span>')
                // Link (new format)
                .replace(/\[link url="([^"]*)" text="([^"]*)"\]/g, '<span class="link-text" onclick="window.open(\'$1\', \'_blank\')">$2</span>')
                // Redirect link with bracket format [R̤Link to redirect to]
                .replace(/\[R̤([^\]]+)\]/g, 'Redirect: <span class="redirect-link" onclick="alert(\'Redirect: $1\')">$1</span>')
                // Category (C̤) - handles multiple categories separated by commas, terminated by period
                .replace(/C̤([^.]+)\./g, function(match, categories) {
                    return 'Categories: ' + categories.split(',').map(cat => 
                        `<span class="category-text">${cat.trim()}</span>`
                    ).join(', ') + '.';
                })
                // Bar
                .replace(/\[bar\](.*?)\[bar\]/g, '<span class="barred-text">$1</span>')
                // Code
                .replace(/\[code\](.*?)\[code\]/g, '<span class="code-text">$1</span>')
                // Comments (remove them, don't render)
                .replace(/\[!([^\]]*)\]/g, '');
            
            output.innerHTML = parsed;
        }

        // Parse initial content
        parseMarkup();
    </script>
</body>
</html>
