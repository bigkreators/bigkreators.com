<!-- File: templates/user_profile.html -->
{% extends "base.html" %}

{% block title %}{{ user.username }} - User Profile - Kryptopedia{% endblock %}

{% block extra_css %}
<style>
    .profile-header {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 20px;
    }
    
    .profile-avatar {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background-color: #0645ad;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 48px;
        font-weight: bold;
    }
    
    .profile-info {
        flex: 1;
    }
    
    .profile-info h1 {
        margin: 0 0 5px 0;
    }
    
    .role-badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 12px;
        margin-left: 10px;
        color: white;
    }
    
    .role-admin {
        background-color: #dc3545;
    }
    
    .role-editor {
        background-color: #28a745;
    }
    
    .role-user {
        background-color: #17a2b8;
    }
    
    .profile-stats {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-top: 10px;
    }
    
    .stat-item {
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    
    .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #0645ad;
    }
    
    .stat-label {
        font-size: 14px;
        color: #666;
    }
    
    .profile-section {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .profile-section h2 {
        margin-top: 0;
        margin-bottom: 15px;
        font-size: 18px;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
    }
    
    .activity-item {
        padding: 10px 0;
        border-bottom: 1px solid #eee;
    }
    
    .activity-item:last-child {
        border-bottom: none;
    }
    
    .activity-date {
        font-size: 12px;
        color: #666;
    }
    
    .edit-button {
        padding: 5px 10px;
        background-color: #0645ad;
        color: white;
        border: none;
        border-radius: 4px;
        text-decoration: none;
        font-size: 14px;
    }
    
    .edit-button:hover {
        background-color: #053a7a;
    }
    
    .no-items {
        padding: 15px;
        text-align: center;
        color: #666;
        font-style: italic;
    }
</style>
{% endblock %}

{% block content %}
<div class="profile-header">
    <div class="profile-avatar">
        {{ user.username[0]|upper }}
    </div>
    <div class="profile-info">
        <h1>
            {{ user.username }}
            {% if user.role == 'admin' %}
                <span class="role-badge role-admin">Admin</span>
            {% elif user.role == 'editor' %}
                <span class="role-badge role-editor">Editor</span>
            {% else %}
                <span class="role-badge role-user">User</span>
            {% endif %}
        </h1>
        {% if is_self or is_admin %}
            <p>{{ user.email }}</p>
        {% endif %}
        <p>Joined: {{ user.joinDate|strftime('%Y-%m-%d') }}</p>
        {% if user.lastLogin %}
            <p>Last active: {{ user.lastLogin|strftime('%Y-%m-%d') }}</p>
        {% endif %}
        
        <div class="profile-stats">
            <div class="stat-item">
                <div class="stat-value">{{ user.contributions.articlesCreated }}</div>
                <div class="stat-label">Articles</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ user.contributions.editsPerformed }}</div>
                <div class="stat-label">Edits</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ user.reputation }}</div>
                <div class="stat-label">Reputation</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ user.contributions.rewardsReceived }}</div>
                <div class="stat-label">Rewards</div>
            </div>
        </div>
        
        {% if is_self or is_admin %}
            <div style="margin-top: 15px;">
                <a href="/users/{{ user._id }}/edit" class="edit-button">Edit Profile</a>
                {% if is_admin and not is_self %}
                    <a href="/admin/users" class="edit-button">Manage User</a>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>

<div class="profile-content">
    <div class="profile-section">
        <h2>Recent Articles</h2>
        {% if articles %}
            {% for article in articles %}
                <div class="activity-item">
                    <a href="/articles/{{ article.slug }}">{{ article.title }}</a>
                    <div class="activity-date">Created: {{ article.createdAt|strftime('%Y-%m-%d') }}</div>
                </div>
            {% endfor %}
        {% else %}
            <div class="no-items">No articles created yet.</div>
        {% endif %}
    </div>
    
    <div class="profile-section">
        <h2>Recent Edits</h2>
        {% if revisions %}
            {% for revision in revisions %}
                <div class="activity-item">
                    <a href="/articles/{{ revision.articleId }}">{{ revision.articleTitle }}</a>
                    <div class="activity-date">
                        {{ revision.createdAt|strftime('%Y-%m-%d %H:%M') }}
                        {% if revision.comment %}
                            - "{{ revision.comment }}"
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="no-items">No edits made yet.</div>
        {% endif %}
    </div>
    
    <div class="profile-section">
        <h2>Recent Proposals</h2>
        {% if proposals %}
            {% for proposal in proposals %}
                <div class="activity-item">
                    <a href="/articles/{{ proposal.articleId }}/proposals/{{ proposal._id }}">
                        Proposal for {{ proposal.articleTitle }}
                    </a>
                    <div class="activity-date">
                        {{ proposal.proposedAt|strftime('%Y-%m-%d %H:%M') }}
                        - Status: 
                        {% if proposal.status == 'pending' %}
                            <span style="color: #856404;">Pending</span>
                        {% elif proposal.status == 'approved' %}
                            <span style="color: #155724;">Approved</span>
                        {% else %}
                            <span style="color: #721c24;">Rejected</span>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="no-items">No proposals submitted yet.</div>
        {% endif %}
    </div>
</div>
{% endblock %}
