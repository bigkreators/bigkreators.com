{% extends "base.html" %}

{% block title %}{{ article.title }} - Kryptopedia{% endblock %}

{% set active_page = 'articles' %}

{% block extra_css %}
<!-- Include wiki editor styles -->
<link rel="stylesheet" href="/static/wiki-editor.css">
<style>
    .article-container {
        max-width: 1000px;
        margin: 0 auto;
    }
    
    .article-header {
        margin-bottom: 20px;
        border-bottom: 1px solid #eaecf0;
        padding-bottom: 10px;
    }
    
    .short-description {
        color: #54595d;
        font-style: italic;
        margin-bottom: 1.5em;
        padding-bottom: 0.5em;
        border-bottom: 1px solid #eaecf0;
    }
    
    .article-content {
        font-family: sans-serif;
        line-height: 1.6;
    }
    
    .wiki-infobox {
        float: right;
        margin: 0 0 1em 1em;
        padding: 0.25em;
        border: 1px solid #a2a9b1;
        background-color: #f8f9fa;
        border-spacing: 3px;
        text-align: left;
        font-size: 88%;
        line-height: 1.5em;
        width: 22em;
    }
    
    .wiki-infobox-title {
        text-align: center;
        font-size: 125%;
        font-weight: bold;
        padding: 0.2em;
        background-color: #eaecf0;
    }
    
    .wiki-infobox-image {
        text-align: center;
        margin: 0.5em;
    }
    
    .wiki-infobox-label {
        width: 33%;
        padding: 0.2em;
        vertical-align: top;
        text-align: left;
        font-weight: bold;
    }
    
    .wiki-infobox-data {
        width: 66%;
        padding: 0.2em;
        vertical-align: top;
    }
    
    .wiki-reference {
        vertical-align: super;
        font-size: smaller;
        line-height: normal;
        color: #0645ad;
    }
    
    .wiki-references {
        margin-top: 1.5em;
        border-top: 1px solid #eaecf0;
        padding-top: 1em;
    }
    
    .wiki-references ol {
        font-size: 90%;
    }
    
    .wiki-category-links {
        margin-top: 1.5em;
        border-top: 1px solid #eaecf0;
        padding-top: 1em;
        font-size: 90%;
    }
    
    .wiki-table {
        border-collapse: collapse;
        margin: 1em 0;
    }
    
    .wiki-table th {
        background-color: #eaecf0;
        text-align: center;
        font-weight: bold;
    }
    
    .wiki-table th, .wiki-table td {
        border: 1px solid #a2a9b1;
        padding: 0.2em 0.4em;
    }
    
    .wiki-image {
        margin: 0.5em;
        padding: 0.25em;
        border: 1px solid #a2a9b1;
        background-color: #f8f9fa;
        text-align: center;
    }
    
    .wiki-image.thumb {
        float: right;
        margin: 0.5em 0 0.5em 1em;
        width: 220px;
    }
    
    .wiki-image.thumb img {
        max-width: 100%;
        height: auto;
    }
    
    .wiki-image-caption {
        font-size: 94%;
        padding: 0.25em;
    }
    
    .wiki-heading-1 {
        font-size: 1.8em;
        margin: 1em 0 0.25em 0;
        padding: 0;
        border-bottom: 1px solid #a2a9b1;
        font-weight: normal;
    }
    
    .wiki-heading-2 {
        font-size: 1.5em;
        margin: 1em 0 0.25em 0;
        padding: 0;
        border-bottom: 1px solid #a2a9b1;
        font-weight: normal;
    }
    
    .wiki-heading-3 {
        font-size: 1.2em;
        margin: 1em 0 0.25em 0;
        padding: 0;
        font-weight: bold;
    }
    
    .wiki-template {
        background-color: #f8f9fa;
        border: 1px solid #a2a9b1;
        padding: 8px;
        margin: 10px 0;
        border-radius: 4px;
    }
</style>
{% endblock %}

{% block sidebar_extra %}
<h3>Article Tools</h3>
<ul>
    <li><a href="/edit-article/{{ article._id }}" id="edit-article" class="auth-required">Edit Article</a></li>
    <li><a href="/articles/{{ article._id }}/propose" id="propose-edit">Propose Edit</a></li>
    <li><a href="/articles/{{ article._id }}/history" id="article-history">History</a></li>
    <li><a href="/articles/{{ article._id }}/proposals" id="article-proposals">View Proposals</a></li>
    <li><a href="/articles/{{ article._id }}/reward" id="reward-article" class="auth-required">Reward Contributor</a></li>
    <li><a href="/articles/{{ article._id }}/talk" id="talk-page">Talk Page</a></li>
</ul>

<h3>Article Information</h3>
<ul>
    <li>Created: {{ article.createdAt|strftime('%Y-%m-%d') }}</li>
    <li>Last updated: {{ article.lastUpdatedAt|strftime('%Y-%m-%d') or article.createdAt|strftime('%Y-%m-%d') }}</li>
    <li>Views: {{ article.views }}</li>
</ul>

{% if article.categories %}
<h3>Categories</h3>
<ul>
    {% for category in article.categories %}
    <li><a href="/articles?category={{ category }}">{{ category }}</a></li>
    {% endfor %}
</ul>
{% endif %}
{% endblock %}

{% block content %}
<div class="article-container">
    <div class="article-header">
        <h1>{{ article.title }}</h1>
        
        {% if short_description %}
        <div class="short-description">{{ short_description }}</div>
        {% endif %}
    </div>
    
    <div class="article-content">
        {{ parsed_content|safe }}
    </div>
    
    {% if article.tags %}
    <div class="wiki-category-links">
        Tags:
        {% for tag in article.tags %}
        <a href="/articles?tag={{ tag }}" class="tag">{{ tag }}</a>
        {% endfor %}
    </div>
    {% endif %}
    
    <div class="article-footer">
        <div class="article-actions">
            <button id="propose-edit-button" class="action-button">Propose Edit</button>
            <button id="edit-button" class="action-button auth-required">Edit Article</button>
            <button id="reward-button" class="action-button auth-required">Reward Author</button>
            <button id="share-button" class="action-button">Share</button>
            <button id="talk-button" class="action-button">Discussion</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Check if user is logged in
    const token = localStorage.getItem('token');
    const authElements = document.querySelectorAll('.auth-required');
    
    if (token) {
        // User is logged in, show auth-required elements
        authElements.forEach(element => {
            element.style.display = 'inline-block';
        });
    } else {
        // User is not logged in, hide auth-required elements
        authElements.forEach(element => {
            element.style.display = 'none';
        });
    }
    
    // Set up buttons
    const proposeEditButton = document.getElementById('propose-edit-button');
    if (proposeEditButton) {
        proposeEditButton.addEventListener('click', function() {
            window.location.href = '/articles/{{ article._id }}/propose';
        });
    }
    
    const editButton = document.getElementById('edit-button');
    if (editButton) {
        editButton.addEventListener('click', function() {
            if (!token) {
                // Not logged in, show login modal
                const loginModal = document.getElementById('login-modal');
                if (loginModal) loginModal.style.display = 'block';
                return;
            }
            
            window.location.href = '/edit-article/{{ article._id }}';
        });
    }
    
    const rewardButton = document.getElementById('reward-button');
    if (rewardButton) {
        rewardButton.addEventListener('click', function() {
            if (!token) {
                // Not logged in, show login modal
                const loginModal = document.getElementById('login-modal');
                if (loginModal) loginModal.style.display = 'block';
                return;
            }
            
            window.location.href = '/articles/{{ article._id }}/reward';
        });
    }
    
    const shareButton = document.getElementById('share-button');
    if (shareButton) {
        shareButton.addEventListener('click', function() {
            // Show share modal or implement sharing functionality
            alert('Share this article: ' + window.location.href);
        });
    }
    
    const talkButton = document.getElementById('talk-button');
    if (talkButton) {
        talkButton.addEventListener('click', function() {
            window.location.href = '/articles/{{ article._id }}/talk';
        });
    }
});
</script>
{% endblock %}
